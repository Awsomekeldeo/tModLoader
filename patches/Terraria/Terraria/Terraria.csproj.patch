--- src/decompiled/Terraria/Terraria.csproj
+++ src/Terraria/Terraria/Terraria.csproj
@@ -1,47 +_,120 @@
 <Project Sdk="Microsoft.NET.Sdk">
-  <Import Project="../Configuration.targets" />
-  <PropertyGroup>
-    <OutputType>WinExe</OutputType>
-    <Version>1.4.3.6</Version>
-    <Company>Re-Logic</Company>
-    <Copyright>Copyright © 2022 Re-Logic</Copyright>
-    <RootNamespace>Terraria</RootNamespace>
-  </PropertyGroup>
-  <PropertyGroup Condition="$(Configuration.Contains('Server'))">
-    <OutputType>Exe</OutputType>
-    <OutputName>$(OutputName)Server</OutputName>
-  </PropertyGroup>
-  <ItemGroup>
-    <Reference Include="CsvHelper" />
-    <Reference Include="Ionic.Zip.CF" />
-    <Reference Include="Microsoft.Xna.Framework" />
-    <Reference Include="Microsoft.Xna.Framework.Game" />
-    <Reference Include="Microsoft.Xna.Framework.Graphics" />
-    <Reference Include="Microsoft.Xna.Framework.Xact" />
-    <Reference Include="MP3Sharp" />
-    <Reference Include="Newtonsoft.Json" />
-    <Reference Include="NVorbis" />
-    <Reference Include="RailSDK.Net" />
-    <ProjectReference Include="../ReLogic/ReLogic.csproj" />
-    <EmbeddedResource Include="../ReLogic/bin/$(Configuration)/$(TargetFramework)/ReLogic.dll">
-      <LogicalName>Terraria.Libraries.ReLogic.ReLogic.dll</LogicalName>
-    </EmbeddedResource>
-    <Reference Include="Steamworks.NET" />
-    <Reference Include="SteelSeriesEngineWrapper" />
-    <Reference Include="System" />
-    <Reference Include="System.Core" />
-    <Reference Include="System.Drawing" />
-    <Reference Include="System.Runtime.Serialization" />
-    <Reference Include="System.Windows.Forms" />
-    <Reference Include="WindowsBase" />
-  </ItemGroup>
-  <ItemGroup>
-    <EmbeddedResource Include="GameContent/Creative/Content/*" />
-    <EmbeddedResource Include="GameContent/Metadata/MaterialData/*" />
-    <EmbeddedResource Include="GameContent/WorldBuilding/*" />
-    <EmbeddedResource Include="IO/Data/*" />
-    <EmbeddedResource Include="Libraries/**" />
-    <EmbeddedResource Include="Localization/Content/**" />
-    <EmbeddedResource Include="Microsoft/**" />
-  </ItemGroup>
+
+	<Import Project="..\Configuration.targets" />
+	<Import Project="..\..\WorkspaceInfo.targets" />
+
+	<!-- Build properties -->
+	<PropertyGroup>
+		<OutputType>WinExe</OutputType>
+		<Version>1.4.3.6</Version>
+		<Company>Re-Logic</Company>
+		<Copyright>Copyright © 2022 Re-Logic</Copyright>
+		<OutputName>Terraria</OutputName>
+		<AssemblyName>Terraria</AssemblyName>
+		<RootNamespace>Terraria</RootNamespace>
+		<ApplicationIcon>Icon.ico</ApplicationIcon>
+		<PdbFile>bin\$(OutputName)</PdbFile>
+	</PropertyGroup>
+
+	<!-- Conditionals -->
+	<PropertyGroup>
+		<!-- Make servers be normal executables. -->
+		<OutputType Condition="$(Configuration.Contains('Server'))">Exe</OutputType>
+
+		<!-- Append 'Server' to AssemblyName if it's a server build. -->
+		<AssemblyName Condition="$(Configuration.Contains('Server'))">$(AssemblyName)Server</AssemblyName>
+
+		<!-- Avoid overwriting Terraria(Server).exe (if it's not Debug - it's Release.) -->
+		<AssemblyName Condition="$(Configuration.Contains('Debug'))">$(AssemblyName)Debug</AssemblyName>
+		<AssemblyName Condition="!$(Configuration.Contains('Debug'))">$(AssemblyName)Release</AssemblyName>
+
+		<!-- Set OutputName to the modified AssemblyName. -->
+		<OutputName>$(AssemblyName)</OutputName>
+	</PropertyGroup>
+
+	<!-- References -->
+	<ItemGroup>
+		<!-- Projects -->
+		<ProjectReference Include="..\ReLogic\ReLogic.csproj" />
+		<!-- DLLs -->
+		<Reference Include="Libraries\Common\SteelSeriesEngineWrapper.dll" />
+		<Reference Include="Libraries\CsvHelper\CsvHelper.dll" />
+		<Reference Include="Libraries\DotNetZip\Ionic.Zip.CF.dll" />
+		<Reference Include="Libraries\FNA\FNA.dll" Condition="$(DefineConstants.Contains('FNA'))" />
+		<Reference Include="Libraries\JSON.NET\Newtonsoft.Json.dll" />
+		<Reference Include="Libraries\MP3Sharp\MP3Sharp.dll" Condition="$(DefineConstants.Contains('CLIENT'))" />
+		<Reference Include="Libraries\NVorbis.System.ValueTuple.dll" />
+		<Reference Include="Libraries\NVorbis\NVorbis.dll" Condition="$(DefineConstants.Contains('CLIENT'))" />
+		<Reference Include="Libraries\RailSDK.Windows\RailSDK.Net.dll" />
+		<Reference Include="Libraries\XNA\Microsoft.Xna.Framework.dll" Condition="$(DefineConstants.Contains('XNA'))" />
+		<Reference Include="Libraries\XNA\Microsoft.Xna.Framework.Game.dll" Condition="$(DefineConstants.Contains('XNA'))" />
+		<Reference Include="Libraries\XNA\Microsoft.Xna.Framework.Graphics.dll" Condition="$(DefineConstants.Contains('XNA'))" />
+		<Reference Include="Libraries\XNA\Microsoft.Xna.Framework.Xact.dll" Condition="$(DefineConstants.Contains('XNA'))" />
+		<Reference Include="Steamworks.NET">
+			<HintPath Condition="$(DefineConstants.Contains('WINDOWS'))">Libraries\Steamworks.NET.Windows\Steamworks.NET.dll</HintPath>
+			<HintPath Condition="$(DefineConstants.Contains('LINUX'))">Libraries\Steamworks.NET.Linux\Steamworks.NET.dll</HintPath>
+			<HintPath Condition="$(DefineConstants.Contains('MAC'))">Libraries\Steamworks.NET.OSX\Steamworks.NET.dll</HintPath>
+		</Reference>
+		<Reference Include="System" />
+		<Reference Include="System.Core" />
+		<Reference Include="System.Drawing" />
+		<Reference Include="System.Runtime.Serialization" />
+		<Reference Include="System.Windows.Forms">
+			<HintPath Condition="$(DefineConstants.Contains('Mono'))">Libraries\Mono\System.Windows.Forms.dll</HintPath>
+		</Reference>
+		<Reference Include="WindowsBase" />
+	</ItemGroup>
+
+	<!-- Resources -->
+	<ItemGroup>
+		<!-- Embedded resources -->
+		<EmbeddedResource Include="GameContent\Creative\Content\*" />
+		<EmbeddedResource Include="GameContent\Metadata\MaterialData\*" />
+		<EmbeddedResource Include="GameContent\WorldBuilding\*" />
+		<EmbeddedResource Include="IO\Data\*" />
+		<EmbeddedResource Include="Libraries\**" />
+		<EmbeddedResource Include="Localization\Content\**" />
+		<EmbeddedResource Include="Microsoft\**" />
+		<EmbeddedResource Include="..\ReLogic\bin\$(Configuration)\$(TargetFramework)\ReLogic.dll">
+			<Link>Libraries\ReLogic\ReLogic.dll</Link>
+			<LogicalName>Terraria.Libraries.ReLogic.ReLogic.dll</LogicalName>
+		</EmbeddedResource>
+
+		<!-- Excluded embedded resources -->
+		<EmbeddedResource Remove="Libraries\FNA\**" />
+		<EmbeddedResource Remove="Libraries\XNA\**" />
+		<EmbeddedResource Remove="Libraries\Native\**" />
+		<EmbeddedResource Remove="Libraries\Steamworks.NET.Windows\**" Condition="!$(DefineConstants.Contains('WINDOWS'))" />
+		<EmbeddedResource Remove="Libraries\Steamworks.NET.Linux\**" Condition="!$(DefineConstants.Contains('LINUX'))" />
+		<EmbeddedResource Remove="Libraries\Steamworks.NET.OSX\**" Condition="!$(DefineConstants.Contains('MAC'))" />
+		<!-- Hide libraries in IDEs -->
+		<None Remove="Libraries\**" />
+	</ItemGroup>
+
+	<!-- Apply 4GB patches -->
+	<Target Name="EditBin" AfterTargets="Build">
+		<PropertyGroup>
+			<EditBinOpts>/largeaddressaware</EditBinOpts>
+			<DumpBin>/headers</DumpBin>
+		</PropertyGroup>
+
+		<PropertyGroup Condition="$(DefineConstants.Contains('DEBUG'))">
+			<EditBinOpts>$(EditBinOpts) /stack:0x800000</EditBinOpts>
+		</PropertyGroup>
+
+		<Message Text="Applying editbin $(EditBinOpts)" Importance="high" />
+		<Exec Command="..\largeaddresstool\editbin $(EditBinOpts) &quot;$(TargetPath)&quot;" />
+
+		<Message Text="Checking headers with dumpbin." Importance="high" />
+		<Exec Command="..\largeaddresstool\dumpbin $(DumpBin) &quot;$(TargetPath)&quot; | findstr &quot;large&quot;" />
+	</Target>
+
+	<!-- Copy files systematically to output folder. -->
+	<Target Name="CopyToSteamDir" AfterTargets="EditBin" Condition="$(Configuration.Contains('Windows'))">
+		<Message Text="Copying $(OutputName) to Steam Dir..." Importance="high" />
+
+		<Copy SourceFiles="$(TargetPath)" DestinationFiles="$(TerrariaSteamPath)\$(OutputName).exe" />
+		<Copy SourceFiles="$(TargetDir)$(OutputName).pdb" DestinationFolder="$(TerrariaSteamPath)" />
+	</Target>
+
 </Project>
